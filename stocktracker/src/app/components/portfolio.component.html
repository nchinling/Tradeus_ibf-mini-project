
<div class = "container-fluid">


    <h4>Welcome, {{username}} ({{accountId}})</h4>
    <h2>Portfolio</h2>

    <div *ngIf="errorMessage" class="error-message">
      {{ errorMessage }}
    </div>

    <div *ngIf="(errorMessage$ | async) as errorMessage" class="error-message">
        <p>{{errorMessage}}</p>
    </div>

    <table *ngIf="(portfolioData$ | async) as portfolioData">
      <thead *ngIf="portfolioData.length > 0">
        <tr>
          <th>Stock Name</th><th>Exchange</th><th>Currency</th>
          <th>Units</th><th>Buy Unit Price</th><th>Buy Total Price</th>
          <th>Unit Current Price</th><th>Total Current Price</th>
          <th>Total Return</th><th>Total Percentage Change</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let data of portfolioData">
          <td>{{ data.stock_name }}</td><td>{{ data.exchange.toUpperCase()}}</td>
          <td>{{ data.currency }}</td><td>{{ data.units }}</td><td>{{ data.buy_unit_price }}</td>
          <td>{{ data.buy_total_price }}</td><td>{{ data.unit_current_price }}</td>
          <td>{{ data.total_current_price }}</td><td>{{ data.total_return }}</td>
          <td>{{ data.total_percentage_change }}</td>
          <!-- <td>{{ data.datetime }}</td> -->
        </tr>
      </tbody>
    </table>

  

    <br>
  
      <h3>Add to Portfolio</h3>
 
    
    <form [formGroup]="portfolioForm" (submit)="processPortfolio()" class="form-container">
      <div class="form-row">
        <label for="exchange">Exchange:</label>
        <div class="form-field">
          <select formControlName="exchange" (change)="fetchExchange(exchange.value)" #exchange>
            <option value="nyse" selected>NYSE</option>
            <option value="nasdaq">NASDAQ</option>
          </select>
        </div>
      </div>
    
      <div class="form-row">
        <label for="stockName">Search:</label>
        <div class="form-field">
          <input type="text" size="30" formControlName="stockName" placeholder="Company Name" (keyup)="filtering(company.value)" #company>
          <div *ngFor="let s of stockSearch$ | async">
            <p (click)="getStockData(s.symbol)" class="stock-item">{{ s.name }} ({{ s.symbol }})</p>
          </div>
        </div>
      </div>
    
      <div class="form-row">
        <label for="units">Units:</label>
        <div class="form-field">
          <input type="number" formControlName="units" steps="0.01">
        </div>
      </div>
    
      <div class="form-row">
        <label for="price">Price:</label>
        <div class="form-field">
          <input type="number" formControlName="price" steps="0.01">
        </div>
      </div>
    
      <div class="form-row">
        <label for="fee">Fee:</label>
        <div class="form-field">
          <input type="number" formControlName="fee" steps="0.01">
        </div>
      </div>
    
      <div class="form-row">
        <label for="date">Date:</label>
        <div class="form-field">
          <input type="date" formControlName="date" placeholder="Date of purchase">
        </div>
        <button class="btn btn-primary" type="submit">Submit</button>
      </div>
    </form>
    
    
    <!-- <form [formGroup]="portfolioForm" (submit)="processPortfolio()">
      <div>
        <label for="exchange">Exchange:</label>
        <select formControlName="exchange" (change)="fetchExchange(exchange.value)" #exchange>
          <option value="nyse" selected>NYSE</option>
          <option value="nasdaq">NASDAQ</option>
        </select>
      </div>
      
      <div>
        <label for="stockName">Search:</label>
        <input type="text" size="30" formControlName="stockName" placeholder="Company Name" (keyup)="filtering(company.value)" #company>
        <div *ngFor="let s of stockSearch$ | async">
          <p (click)="getStockData(s.symbol)" class="stock-item">{{ s.name }} ({{ s.symbol }})</p>
        </div>
      </div>
      
      <div>
        <label for="units">Units:</label>
        <input type="number" formControlName="units" steps="0.01">
      </div>
      
      <div>
        <label for="price">Price:</label>
        <input type="number" formControlName="price" steps="0.01">
      </div>
      
      <div>
        <label for="fee">Fee:</label>
        <input type="number" formControlName="fee" steps="0.01">
      </div>
      
      <div>
        <label for="date">Date:</label>
        <input type="date" formControlName="date" placeholder="Date of purchase">
      </div>
      
      <div>
        <button class="btn btn-primary" type="submit">Submit</button>
      </div>
    </form> -->
    
    <!-- <form [formGroup]="portfolioForm" (submit)="processPortfolio()">
        <table>
            <tr>
                <td>Exchange: </td>
                <td>
                    <select formControlName="exchange" (change)="fetchExchange(exchange.value)" #exchange>
                        <option value="nyse" selected>NYSE</option>
                        <option value="nasdaq">NASDAQ</option>
                    </select>
                </td>
            </tr>
            <br>
            <tr>
                <td>Search:&nbsp;&nbsp;</td>
                <td>
                    <input type="text" size="30" formControlName="stockName" placeholder="Company Name" (keyup)="filtering(company.value)" #company>
                    <div *ngFor="let s of stockSearch$ | async">
                        <p (click)="getStockData(s.symbol)" class="stock-item">{{ s.name }} ({{ s.symbol }})</p>
                  </div>
                </td>

            </tr>
            <br>
          
            <tr>
                <td>Units:&nbsp;&nbsp;</td>
                <td>
                    <input type="number" formControlName="units" steps="0.01" >
                </td>
            </tr>
            <br>
            <tr>
                <td>Price:&nbsp;&nbsp;</td>
                <td>
                    <input type="number" formControlName="price" steps="0.01" >
                </td>
            </tr>
            <br>
            <tr>
                <td>Fee:&nbsp;&nbsp;</td>
                <td>
                    <input type="number" formControlName="fee" steps="0.01" >
                </td>
            </tr>
            <br>
          <tr>
            <td>Date:&nbsp;&nbsp;</td>
            <td>
                <input type="date" size="30" formControlName="date" placeholder="Date of purchase">
            </td>
          </tr>
          <br>
          <tr>
            <td></td>
            <td>
              <button class="btn btn-primary" type="submit">Submit</button>

            </td>
          </tr>
          <br>
        </table>
      
      </form> -->
</div>



<br>

  



